res_KGN_15a_vs_control <- results(dds_KGN, contrast = c("Treat", "15a", "Control"))
res_KGN_15c_vs_control <- results(dds_KGN, contrast = c("Treat", "15c", "Control"))
# MHCC分析
mata_MHCC <- subset(mata_data, mata_data$CellLine == "MHCC")
qua_count_data_MHCC <- count_data[, rownames(mata_MHCC)]
dds_MHCC <- DESeqDataSetFromMatrix(countData = qua_count_data_MHCC, colData = mata_MHCC, design = ~ Treat)
dds_MHCC <- DESeq(dds_MHCC)
res_MHCC_15an_vs_control <- results(dds_MHCC, contrast = c("Treat", "15an", "Control"))
res_MHCC_15a_vs_control <- results(dds_MHCC, contrast = c("Treat", "15a", "Control"))
res_MHCC_15c_vs_control <- results(dds_MHCC, contrast = c("Treat", "15c", "Control"))
# 筛选差异基因 (padj < 0.05 and log2FoldChange > 1)
get_significant_genes <- function(res, padj_cutoff = 0.05, lfc_cutoff = 1) {
res_sig <- res[which(res$padj < padj_cutoff & abs(res$log2FoldChange) > lfc_cutoff), ]
return(rownames(res_sig))
}
# KGN差异基因
genes_KGN_15an <- get_significant_genes(res_KGN_15an_vs_control)
genes_KGN_15a <- get_significant_genes(res_KGN_15a_vs_control)
genes_KGN_15c <- get_significant_genes(res_KGN_15c_vs_control)
# MHCC差异基因
genes_MHCC_15an <- get_significant_genes(res_MHCC_15an_vs_control)
genes_MHCC_15a <- get_significant_genes(res_MHCC_15a_vs_control)
genes_MHCC_15c <- get_significant_genes(res_MHCC_15c_vs_control)
# 火山图绘制函数
create_volcano_plot <- function(res, title) {
res$significance <- "Not Significant"
res$significance[res$pvalue < 0.001 & res$log2FoldChange > 2] <- "Upregulated"
res$significance[res$pvalue < 0.001 & res$log2FoldChange < -2] <- "Downregulated"
res$significance <- factor(res$significance, levels = c("Upregulated", "Downregulated", "Not Significant"))
ggplot(res, aes(x = log2FoldChange, y = -log10(pvalue), color = significance)) +
geom_point(alpha = 0.4, size = 2) +  # 点的大小和透明度
scale_color_manual(values = c("Upregulated" = viridis(1),
"Downregulated" = rgb(140, 180, 220, maxColorValue = 255),
"Not Significant" = "gray80")) +
geom_hline(yintercept = -log10(0.001), linetype = "dashed", color = "black", linewidth = 0.8) +  # p-value cutoff
geom_vline(xintercept = c(-2, 2), linetype = "dashed", color = "black", linewidth = 0.8) +  # log2FoldChange cutoff
theme_minimal(base_size = 14) +  # 设置基础字体大小
labs(title = title, x = "Log2 Fold Change", y = "-Log10 P-value", color = "Expression") +
theme(legend.position = "top")
}
# KGN火山图
create_volcano_plot(res_KGN_15an_vs_control, "KGN 15an vs Control")
create_volcano_plot(res_KGN_15a_vs_control, "KGN 15a vs Control")
create_volcano_plot(res_KGN_15c_vs_control, "KGN 15c vs Control")
# MHCC火山图
create_volcano_plot(res_MHCC_15an_vs_control, "MHCC 15an vs Control")
create_volcano_plot(res_MHCC_15a_vs_control, "MHCC 15a vs Control")
create_volcano_plot(res_MHCC_15c_vs_control, "MHCC 15c vs Control")
# MA图绘制函数
create_MA_plot <- function(res, title) {
plotMA(res, main = title, ylim = c(-2, 2))
}
# KGN MA图
create_MA_plot(res_KGN_15an_vs_control, "KGN 15an vs Control MA Plot")
sum(is.na(res_MHCC_15c_vs_control$pvalue))
sum(is.na(res_MHCC_15c_vs_control$log2FoldChange))
View(res_KGN_15a_vs_control)
summary(res_MHCC_15c_vs_control)
table(is.na(res_MHCC_15c_vs_control$pvalue))
table(is.na(res_MHCC_15c_vs_control$log2FoldChange))
# Volcano Plot with cutoffs and annotation for Downregulated genes
ggplot(res, aes(x = log2FoldChange, y = -log10(pvalue), color = significance)) +
geom_point(alpha = 0.4, size = 2) +  # 点的大小和透明度
scale_color_manual(values = c("Upregulated" = viridis(1),
"Downregulated" = rgb(140, 180, 220, maxColorValue = 255),
"Not Significant" = "gray80")) +
geom_hline(yintercept = -log10(0.001), linetype = "dashed", color = "black", linewidth = 0.8) +  # p-value cutoff
geom_vline(xintercept = c(-2, 2), linetype = "dashed", color = "black", linewidth = 0.8) +  # log2FoldChange cutoff
theme_minimal(base_size = 14) +  # 设置基础字体大小
labs(
title = "Volcano Plot",
x = "Log2 Fold Change",
y = "-Log10 P-value",
color = "Expression"
) +
theme(
legend.position = "top",
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
axis.text = element_text(size = 10),
panel.grid = element_blank(),  # 移除网格线
axis.line = element_line(color = "black"),  # 设置坐标轴线
axis.ticks = element_line(color = "black"),  # 添加坐标轴短线
axis.ticks.length = unit(0.2, "cm")  # 设置坐标轴短线的长度
)
# 火山图绘制函数
create_volcano_plot <- function(res, title) {
# Categorize genes based on significance and fold change
res$significance <- "Not Significant"
res$significance[res$pvalue < 0.001 & res$log2FoldChange > 2] <- "Upregulated"
res$significance[res$pvalue < 0.001 & res$log2FoldChange < -2] <- "Downregulated"
res$significance <- factor(res$significance, levels = c("Upregulated", "Downregulated", "Not Significant"))
# Create volcano plot
ggplot(res, aes(x = log2FoldChange, y = -log10(pvalue), color = significance)) +
geom_point(alpha = 0.4, size = 2) +  # Adjust the transparency and size of points
scale_color_manual(values = c("Upregulated" = viridis(1),
"Downregulated" = rgb(140, 180, 220, maxColorValue = 255),
"Not Significant" = "gray80")) +  # Set custom colors
geom_hline(yintercept = -log10(0.001), linetype = "dashed", color = "black", linewidth = 0.8) +  # P-value cutoff line
geom_vline(xintercept = c(-2, 2), linetype = "dashed", color = "black", linewidth = 0.8) +  # log2FoldChange cutoff lines
theme_minimal(base_size = 14) +  # Base font size for the plot
labs(
title = title,
x = "Log2 Fold Change",
y = "-Log10 P-value",
color = "Expression"
) +
theme(
legend.position = "top",  # Position of the legend
legend.title = element_text(size = 12, face = "bold"),  # Style legend title
legend.text = element_text(size = 10),  # Style legend text
plot.title = element_text(size = 16, face = "bold", hjust = 0.5),  # Title styling
axis.title.x = element_text(size = 12, face = "bold"),  # X-axis label styling
axis.title.y = element_text(size = 12, face = "bold"),  # Y-axis label styling
axis.text = element_text(size = 10),  # Axis tick labels styling
panel.grid = element_blank(),  # Remove grid lines
axis.line = element_line(color = "black"),  # Add black axis lines
axis.ticks = element_line(color = "black"),  # Add axis ticks
axis.ticks.length = unit(0.2, "cm")  # Set length of axis ticks
)
}
# MHCC火山图
create_volcano_plot(res_MHCC_15an_vs_control, "MHCC 15an vs Control")
create_volcano_plot(res_MHCC_15a_vs_control, "MHCC 15a vs Control")
create_volcano_plot(res_MHCC_15c_vs_control, "MHCC 15c vs Control")
# KGN火山图
create_volcano_plot(res_KGN_15an_vs_control, "KGN 15an vs Control")
create_volcano_plot(res_KGN_15a_vs_control, "KGN 15a vs Control")
create_volcano_plot(res_KGN_15c_vs_control, "KGN 15c vs Control")
library(DESeq2)
library(ggplot2)
library(pheatmap)
library(org.Mm.eg.db)
library(org.Hs.eg.db)
library(clusterProfiler)
library(enrichplot)
library(viridis)
library(ggrepel)
library(viridis)
count_data <- read.csv("./JiaGroup.counts.csv",row.names = 1)
count_data <- as.matrix(count_data)
qua_count_data <- subset(count_data, rowSums(count_data)>0)
mata_data <- read.csv("matadata.csv",header = TRUE,row.names = 1)
#KGN
mata_KGN <-subset(mata_data,mata_data$CellLine=="KGN")
qua_count_data_KGN <- qua_count_data[,rownames(mata_KGN)]
dds_KGN <- DESeqDataSetFromMatrix(countData = qua_count_data_KGN,
colData = mata_KGN,
design = ~ Treat)
dds_KGN <- DESeq(dds_KGN)
res_KGN_15an_vs_control <- results(dds_KGN, contrast = c("Treat", "15an","Control"))
res_KGN_15a_vs_control <- results(dds_KGN, contrast = c("Treat", "15a","Control"))
res_KGN_15c_vs_control <- results(dds_KGN, contrast = c("Treat", "15c","Control"))
#MHCC-72H
mata_MHCC <-subset(mata_data,mata_data$CellLine=="MHCC")
qua_count_data_MHCC <- qua_count_data[,rownames(mata_MHCC)]
dds_MHCC <- DESeqDataSetFromMatrix(countData = qua_count_data_MHCC,
colData = mata_MHCC,
design = ~ Treat)
dds_MHCC <- DESeq(dds_MHCC)
res_MHCC_15an_vs_control <- results(dds_MHCC, contrast = c("Treat", "15an","Control"))
res_MHCC_15a_vs_control <- results(dds_MHCC, contrast = c("Treat", "15a","Control"))
res_MHCC_15c_vs_control <- results(dds_MHCC, contrast = c("Treat", "15c","Control"))
# 筛选差异基因 (根据padj和log2FoldChange阈值)
get_significant_genes <- function(res, padj_cutoff = 0.05, lfc_cutoff = 1) {
res_sig <- res[which(res$padj < padj_cutoff & abs(res$log2FoldChange) > lfc_cutoff), ]
return(rownames(res_sig))
}
# 获取每种药物的差异基因
genes_KGN_15an <- get_significant_genes(res_KGN_15an_vs_control)
genes_KGN_15a <- get_significant_genes(res_KGN_15a_vs_control)
genes_KGN_15c <- get_significant_genes(res_KGN_15c_vs_control)
genes_MHCC_15an <- get_significant_genes(res_MHCC_15an_vs_control)
genes_MHCC_15a <- get_significant_genes(res_MHCC_15a_vs_control)
genes_MHCC_15c <- get_significant_genes(res_MHCC_15c_vs_control)
# 筛选上调基因
get_upregulated_genes <- function(res, lfc_cutoff = 1) {
# log2FoldChange > lfc_cutoff 表示上调
return(rownames(res[which(res$log2FoldChange > lfc_cutoff), ]))
}
# 筛选下调基因
get_downregulated_genes <- function(res, lfc_cutoff = 1) {
# log2FoldChange < -lfc_cutoff 表示下调
return(rownames(res[which(res$log2FoldChange < -lfc_cutoff), ]))
}
# 获取每种药物的上调和下调差异基因
upregulated_MHCC_15an <- get_upregulated_genes(res_MHCC_15an_vs_control)
downregulated_MHCC_15an <- get_downregulated_genes(res_MHCC_15an_vs_control)
upregulated_MHCC_15a <- get_upregulated_genes(res_MHCC_15a_vs_control)
downregulated_MHCC_15a <- get_downregulated_genes(res_MHCC_15a_vs_control)
upregulated_MHCC_15c <- get_upregulated_genes(res_MHCC_15c_vs_control)
downregulated_MHCC_15c <- get_downregulated_genes(res_MHCC_15c_vs_control)
# 获取MHCC与KGN差异基因的交集
intersection_15an <- intersect(upregulated_MHCC_15an, genes_KGN_15an)
intersection_15a <- intersect(upregulated_MHCC_15a, genes_KGN_15a)
intersection_15c <- intersect(upregulated_MHCC_15c, genes_KGN_15c)
# 从MHCC的差异基因中去除与KGN的交集部分
unique_upregulated_MHCC_15an <- setdiff(upregulated_MHCC_15an, intersection_15an)
unique_upregulated_MHCC_15a <- setdiff(upregulated_MHCC_15a, intersection_15a)
unique_upregulated_MHCC_15c <- setdiff(upregulated_MHCC_15c, intersection_15c)
# 对下调基因执行相同操作
intersection_down_15an <- intersect(downregulated_MHCC_15an, genes_KGN_15an)
intersection_down_15a <- intersect(downregulated_MHCC_15a, genes_KGN_15a)
intersection_down_15c <- intersect(downregulated_MHCC_15c, genes_KGN_15c)
unique_downregulated_MHCC_15an <- setdiff(downregulated_MHCC_15an, intersection_down_15an)
unique_downregulated_MHCC_15a <- setdiff(downregulated_MHCC_15a, intersection_down_15a)
unique_downregulated_MHCC_15c <- setdiff(downregulated_MHCC_15c, intersection_down_15c)
# 计算交集
comm_upregulated_genes <- Reduce(intersect, list(unique_upregulated_MHCC_15an, unique_upregulated_MHCC_15a, unique_upregulated_MHCC_15c))
comm_downregulated_genes <- Reduce(intersect, list(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15a, unique_downregulated_MHCC_15c))
# 查看交集基因的数量
length(comm_upregulated_genes)  # 查看上调基因交集的数量
length(comm_downregulated_genes)  # 查看下调基因交集的数量
library(DESeq2)
library(ggplot2)
library(pheatmap)
library(org.Mm.eg.db)
library(org.Hs.eg.db)
library(clusterProfiler)
library(enrichplot)
library(viridis)
library(ggrepel)
library(viridis)
count_data <- read.csv("./JiaGroup.counts.csv",row.names = 1)
count_data <- as.matrix(count_data)
qua_count_data <- subset(count_data, rowSums(count_data)>0)
mata_data <- read.csv("matadata.csv",header = TRUE,row.names = 1)
#KGN
mata_KGN <-subset(mata_data,mata_data$CellLine=="KGN")
qua_count_data_KGN <- qua_count_data[,rownames(mata_KGN)]
dds_KGN <- DESeqDataSetFromMatrix(countData = qua_count_data_KGN,
colData = mata_KGN,
design = ~ Treat)
dds_KGN <- DESeq(dds_KGN)
res_KGN_15an_vs_control <- results(dds_KGN, contrast = c("Treat", "15an","Control"))
res_KGN_15a_vs_control <- results(dds_KGN, contrast = c("Treat", "15a","Control"))
res_KGN_15c_vs_control <- results(dds_KGN, contrast = c("Treat", "15c","Control"))
#MHCC-72H
mata_MHCC <-subset(mata_data,mata_data$CellLine=="MHCC")
qua_count_data_MHCC <- qua_count_data[,rownames(mata_MHCC)]
dds_MHCC <- DESeqDataSetFromMatrix(countData = qua_count_data_MHCC,
colData = mata_MHCC,
design = ~ Treat)
dds_MHCC <- DESeq(dds_MHCC)
res_MHCC_15an_vs_control <- results(dds_MHCC, contrast = c("Treat", "15an","Control"))
res_MHCC_15a_vs_control <- results(dds_MHCC, contrast = c("Treat", "15a","Control"))
res_MHCC_15c_vs_control <- results(dds_MHCC, contrast = c("Treat", "15c","Control"))
# 筛选差异基因 (根据padj和log2FoldChange阈值)
get_significant_genes <- function(res, padj_cutoff = 0.05, lfc_cutoff = 1) {
res_sig <- res[which(res$padj < padj_cutoff & abs(res$log2FoldChange) > lfc_cutoff), ]
return(rownames(res_sig))
}
# 获取每种药物的差异基因
genes_KGN_15an <- get_significant_genes(res_KGN_15an_vs_control)
genes_KGN_15a <- get_significant_genes(res_KGN_15a_vs_control)
genes_KGN_15c <- get_significant_genes(res_KGN_15c_vs_control)
genes_MHCC_15an <- get_significant_genes(res_MHCC_15an_vs_control)
genes_MHCC_15a <- get_significant_genes(res_MHCC_15a_vs_control)
genes_MHCC_15c <- get_significant_genes(res_MHCC_15c_vs_control)
# 获取MHCC与KGN差异基因的交集
intersection_15an <- intersect(genes_MHCC_15an, genes_KGN_15an)
intersection_15a <- intersect(genes_MHCC_15a, genes_KGN_15a)
intersection_15c <- intersect(genes_MHCC_15c, genes_KGN_15c)
# 从MHCC的差异基因中去除与KGN的交集部分
unique_genes_15an <- setdiff(genes_MHCC_15an, intersection_15an)
unique_genes_15a <- setdiff(genes_MHCC_15a, intersection_15a)
unique_genes_15c <- setdiff(genes_MHCC_15c, intersection_15c)
# 计算至少两两交集的基因
intersection_15an_15a <- intersect(unique_genes_15an, unique_genes_15a)
intersection_15an_15c <- intersect(unique_genes_15an, unique_genes_15c)
intersection_15a_15c <- intersect(unique_genes_15a, unique_genes_15c)
# 合并这些交集，得到至少两两交集的基因
two_way_intersection <- unique(c(intersection_15an_15a, intersection_15an_15c, intersection_15a_15c))
# 筛选上调基因
get_upregulated_genes <- function(res, lfc_cutoff = 1) {
# log2FoldChange > lfc_cutoff 表示上调
return(rownames(res[which(res$log2FoldChange > lfc_cutoff), ]))
}
# 筛选下调基因
get_downregulated_genes <- function(res, lfc_cutoff = 1) {
# log2FoldChange < -lfc_cutoff 表示下调
return(rownames(res[which(res$log2FoldChange < -lfc_cutoff), ]))
}
# 获取每种药物的上调和下调差异基因
upregulated_MHCC_15an <- get_upregulated_genes(res_MHCC_15an_vs_control)
downregulated_MHCC_15an <- get_downregulated_genes(res_MHCC_15an_vs_control)
upregulated_MHCC_15a <- get_upregulated_genes(res_MHCC_15a_vs_control)
downregulated_MHCC_15a <- get_downregulated_genes(res_MHCC_15a_vs_control)
upregulated_MHCC_15c <- get_upregulated_genes(res_MHCC_15c_vs_control)
downregulated_MHCC_15c <- get_downregulated_genes(res_MHCC_15c_vs_control)
# 获取MHCC与KGN差异基因的交集
intersection_15an <- intersect(upregulated_MHCC_15an, genes_KGN_15an)
intersection_15a <- intersect(upregulated_MHCC_15a, genes_KGN_15a)
intersection_15c <- intersect(upregulated_MHCC_15c, genes_KGN_15c)
# 从MHCC的差异基因中去除与KGN的交集部分
unique_upregulated_MHCC_15an <- setdiff(upregulated_MHCC_15an, intersection_15an)
unique_upregulated_MHCC_15a <- setdiff(upregulated_MHCC_15a, intersection_15a)
unique_upregulated_MHCC_15c <- setdiff(upregulated_MHCC_15c, intersection_15c)
# 对下调基因执行相同操作
intersection_down_15an <- intersect(downregulated_MHCC_15an, genes_KGN_15an)
intersection_down_15a <- intersect(downregulated_MHCC_15a, genes_KGN_15a)
intersection_down_15c <- intersect(downregulated_MHCC_15c, genes_KGN_15c)
unique_downregulated_MHCC_15an <- setdiff(downregulated_MHCC_15an, intersection_down_15an)
unique_downregulated_MHCC_15a <- setdiff(downregulated_MHCC_15a, intersection_down_15a)
unique_downregulated_MHCC_15c <- setdiff(downregulated_MHCC_15c, intersection_down_15c)
# 计算交集
comm_upregulated_genes <- Reduce(intersect, list(unique_upregulated_MHCC_15an, unique_upregulated_MHCC_15a, unique_upregulated_MHCC_15c))
comm_downregulated_genes <- Reduce(intersect, list(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15a, unique_downregulated_MHCC_15c))
# 查看交集基因的数量
length(comm_upregulated_genes)  # 查看上调基因交集的数量
length(comm_downregulated_genes)  # 查看下调基因交集的数量
# 创建上调基因的韦恩图
venn_upregulated <- venn.diagram(
x = list("15an" = unique_upregulated_MHCC_15an,
"15a" = unique_upregulated_MHCC_15a,
"15c" = unique_upregulated_MHCC_15c),
filename = NULL,
fill = c("red", "green", "blue"),
alpha = 0.5,
cex = 1.5,
fontface = "bold",
fontfamily = "sans",
cat.cex = 1.2,
cat.fontface = "bold",
cat.fontfamily = "sans",
main = "Venn Diagram of Upregulated Genes in MHCC"
)
library(VennDiagram)
# 创建上调基因的韦恩图
venn_upregulated <- venn.diagram(
x = list("15an" = unique_upregulated_MHCC_15an,
"15a" = unique_upregulated_MHCC_15a,
"15c" = unique_upregulated_MHCC_15c),
filename = NULL,
fill = c("red", "green", "blue"),
alpha = 0.5,
cex = 1.5,
fontface = "bold",
fontfamily = "sans",
cat.cex = 1.2,
cat.fontface = "bold",
cat.fontfamily = "sans",
main = "Venn Diagram of Upregulated Genes in MHCC"
)
# 展示上调基因的韦恩图
grid.draw(venn_upregulated)
library(DESeq2)
library(ggplot2)
library(pheatmap)
library(org.Mm.eg.db)
library(org.Hs.eg.db)
library(clusterProfiler)
library(enrichplot)
library(viridis)
library(ggrepel)
library(viridis)
count_data <- read.csv("./JiaGroup.counts.csv",row.names = 1)
count_data <- as.matrix(count_data)
qua_count_data <- subset(count_data, rowSums(count_data)>0)
mata_data <- read.csv("matadata.csv",header = TRUE,row.names = 1)
#KGN
mata_KGN <-subset(mata_data,mata_data$CellLine=="KGN")
qua_count_data_KGN <- qua_count_data[,rownames(mata_KGN)]
dds_KGN <- DESeqDataSetFromMatrix(countData = qua_count_data_KGN,
colData = mata_KGN,
design = ~ Treat)
library(DESeq2)
library(ggplot2)
library(pheatmap)
library(org.Mm.eg.db)
library(org.Hs.eg.db)
library(clusterProfiler)
library(enrichplot)
library(viridis)
library(ggrepel)
library(viridis)
count_data <- read.csv("./JiaGroup.counts.csv",row.names = 1)
count_data <- as.matrix(count_data)
qua_count_data <- subset(count_data, rowSums(count_data)>0)
mata_data <- read.csv("matadata.csv",header = TRUE,row.names = 1)
#KGN
mata_KGN <-subset(mata_data,mata_data$CellLine=="KGN")
qua_count_data_KGN <- qua_count_data[,rownames(mata_KGN)]
dds_KGN <- DESeqDataSetFromMatrix(countData = qua_count_data_KGN,
colData = mata_KGN,
design = ~ Treat)
dds_KGN <- DESeq(dds_KGN)
res_KGN_15an_vs_control <- results(dds_KGN, contrast = c("Treat", "15an","Control"))
res_KGN_15a_vs_control <- results(dds_KGN, contrast = c("Treat", "15a","Control"))
res_KGN_15c_vs_control <- results(dds_KGN, contrast = c("Treat", "15c","Control"))
#MHCC-72H
mata_MHCC <-subset(mata_data,mata_data$CellLine=="MHCC")
qua_count_data_MHCC <- qua_count_data[,rownames(mata_MHCC)]
dds_MHCC <- DESeqDataSetFromMatrix(countData = qua_count_data_MHCC,
colData = mata_MHCC,
design = ~ Treat)
dds_MHCC <- DESeq(dds_MHCC)
res_MHCC_15an_vs_control <- results(dds_MHCC, contrast = c("Treat", "15an","Control"))
res_MHCC_15a_vs_control <- results(dds_MHCC, contrast = c("Treat", "15a","Control"))
res_MHCC_15c_vs_control <- results(dds_MHCC, contrast = c("Treat", "15c","Control"))
# 筛选下调基因
get_downregulated_genes <- function(res, padj_cutoff = 0.05, lfc_cutoff = 1) {
# log2FoldChange < -lfc_cutoff 表示下调
return(rownames(res[which(res$padj < padj_cutoff & res$log2FoldChange < -lfc_cutoff), ]))
}
# 筛选上调基因
get_upregulated_genes <- function(res, padj_cutoff = 0.05, lfc_cutoff = 1) {
# log2FoldChange > lfc_cutoff 表示上调
return(rownames(res[which(res$padj < padj_cutoff & res$log2FoldChange > lfc_cutoff), ]))
}
# 筛选下调基因
get_downregulated_genes <- function(res, padj_cutoff = 0.05, lfc_cutoff = 1) {
# log2FoldChange < -lfc_cutoff 表示下调
return(rownames(res[which(res$padj < padj_cutoff & res$log2FoldChange < -lfc_cutoff), ]))
}
# 获取每种药物的上调和下调差异基因
upregulated_MHCC_15an <- get_upregulated_genes(res_MHCC_15an_vs_control)
downregulated_MHCC_15an <- get_downregulated_genes(res_MHCC_15an_vs_control)
upregulated_MHCC_15a <- get_upregulated_genes(res_MHCC_15a_vs_control)
downregulated_MHCC_15a <- get_downregulated_genes(res_MHCC_15a_vs_control)
upregulated_MHCC_15c <- get_upregulated_genes(res_MHCC_15c_vs_control)
downregulated_MHCC_15c <- get_downregulated_genes(res_MHCC_15c_vs_control)
# 获取MHCC与KGN差异基因的交集
intersection_15an <- intersect(upregulated_MHCC_15an, genes_KGN_15an)
# 筛选差异基因 (根据padj和log2FoldChange阈值)
get_significant_genes <- function(res, padj_cutoff = 0.05, lfc_cutoff = 1) {
res_sig <- res[which(res$padj < padj_cutoff & abs(res$log2FoldChange) > lfc_cutoff), ]
return(rownames(res_sig))
}
# 获取每种药物的差异基因
genes_KGN_15an <- get_significant_genes(res_KGN_15an_vs_control)
genes_KGN_15a <- get_significant_genes(res_KGN_15a_vs_control)
genes_KGN_15c <- get_significant_genes(res_KGN_15c_vs_control)
genes_MHCC_15an <- get_significant_genes(res_MHCC_15an_vs_control)
genes_MHCC_15a <- get_significant_genes(res_MHCC_15a_vs_control)
genes_MHCC_15c <- get_significant_genes(res_MHCC_15c_vs_control)
# 筛选上调基因
get_upregulated_genes <- function(res, padj_cutoff = 0.05, lfc_cutoff = 1) {
# log2FoldChange > lfc_cutoff 表示上调
return(rownames(res[which(res$padj < padj_cutoff & res$log2FoldChange > lfc_cutoff), ]))
}
# 筛选下调基因
get_downregulated_genes <- function(res, padj_cutoff = 0.05, lfc_cutoff = 1) {
# log2FoldChange < -lfc_cutoff 表示下调
return(rownames(res[which(res$padj < padj_cutoff & res$log2FoldChange < -lfc_cutoff), ]))
}
# 获取每种药物的上调和下调差异基因
upregulated_MHCC_15an <- get_upregulated_genes(res_MHCC_15an_vs_control)
downregulated_MHCC_15an <- get_downregulated_genes(res_MHCC_15an_vs_control)
upregulated_MHCC_15a <- get_upregulated_genes(res_MHCC_15a_vs_control)
downregulated_MHCC_15a <- get_downregulated_genes(res_MHCC_15a_vs_control)
upregulated_MHCC_15c <- get_upregulated_genes(res_MHCC_15c_vs_control)
downregulated_MHCC_15c <- get_downregulated_genes(res_MHCC_15c_vs_control)
# 获取MHCC与KGN差异基因的交集
intersection_15an <- intersect(upregulated_MHCC_15an, genes_KGN_15an)
intersection_15a <- intersect(upregulated_MHCC_15a, genes_KGN_15a)
intersection_15c <- intersect(upregulated_MHCC_15c, genes_KGN_15c)
# 从MHCC的差异基因中去除与KGN的交集部分
unique_upregulated_MHCC_15an <- setdiff(upregulated_MHCC_15an, intersection_15an)
unique_upregulated_MHCC_15a <- setdiff(upregulated_MHCC_15a, intersection_15a)
unique_upregulated_MHCC_15c <- setdiff(upregulated_MHCC_15c, intersection_15c)
# 对下调基因执行相同操作
intersection_down_15an <- intersect(downregulated_MHCC_15an, genes_KGN_15an)
intersection_down_15a <- intersect(downregulated_MHCC_15a, genes_KGN_15a)
intersection_down_15c <- intersect(downregulated_MHCC_15c, genes_KGN_15c)
unique_downregulated_MHCC_15an <- setdiff(downregulated_MHCC_15an, intersection_down_15an)
unique_downregulated_MHCC_15a <- setdiff(downregulated_MHCC_15a, intersection_down_15a)
unique_downregulated_MHCC_15c <- setdiff(downregulated_MHCC_15c, intersection_down_15c)
# 计算交集
comm_upregulated_genes <- Reduce(intersect, list(unique_upregulated_MHCC_15an, unique_upregulated_MHCC_15a, unique_upregulated_MHCC_15c))
comm_downregulated_genes <- Reduce(intersect, list(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15a, unique_downregulated_MHCC_15c))
# 查看交集基因的数量
length(comm_upregulated_genes)  # 查看上调基因交集的数量
length(comm_downregulated_genes)  # 查看下调基因交集的数量
unique_downregulated_MHCC_15an <- setdiff(downregulated_MHCC_15an, intersection_down_15an)
unique_downregulated_MHCC_15a <- setdiff(downregulated_MHCC_15a, intersection_down_15a)
unique_downregulated_MHCC_15c <- setdiff(downregulated_MHCC_15c, intersection_down_15c)
intersect_upregulated_15an_15a <- intersect(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15a)
intersect_upregulated_15an_15c <- intersect(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15c)
intersect_upregulated_15a_15c <- intersect(unique_downregulated_MHCC_15a, unique_downregulated_MHCC_15c)
intersect_downregulated_15an_15a <- intersect(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15a)
intersect_downregulated_15an_15c <- intersect(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15c)
intersect_downregulated_15a_15c <- intersect(unique_downregulated_MHCC_15a, unique_downregulated_MHCC_15c)
combined_upregulated_intersection <- union(intersect_upregulated_15an_15a, intersect_upregulated_15an_15c)
combined_upregulated_intersection <- union(combined_upregulated_intersection, intersect_15a_15c)
combined_downregulated_intersection <- union(intersect_downregulated_15an_15a, intersect_downregulated_15an_15c)
combined_upregulated_intersection <- union(combined_upregulated_intersection, intersect_upregulated_15a_15c)
combined_downregulated_intersection <- union(intersect_downregulated_15an_15a, intersect_downregulated_15an_15c)
combined_downregulated_intersection <- union(combined_downregulated_intersection, intersect_downregulated_15a_15c)
write.csv(combined_upregulated_intersection, "combined_upregulated_intersection.csv", row.names = FALSE)
write.csv(combined_downregulated_intersection, "combined_downregulated_intersection.csv", row.names = FALSE)
# 计算交集
comm_upregulated_genes <- Reduce(intersect, list(unique_upregulated_MHCC_15an, unique_upregulated_MHCC_15a, unique_upregulated_MHCC_15c))
comm_downregulated_genes <- Reduce(intersect, list(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15a, unique_downregulated_MHCC_15c))
# 查看交集基因的数量
length(comm_upregulated_genes)  # 查看上调基因交集的数量
length(comm_downregulated_genes)  # 查看下调基因交集的数量
intersect_upregulated_15an_15a <- intersect(unique_upregulated_MHCC_15an, unique_upregulated_MHCC_15a)
intersect_upregulated_15an_15c <- intersect(unique_upregulated_MHCC_15an, unique_upregulated_MHCC_15c)
intersect_upregulated_15a_15c <- intersect(unique_upregulated_MHCC_15a, unique_upregulated_MHCC_15c)
intersect_downregulated_15an_15a <- intersect(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15a)
intersect_downregulated_15an_15c <- intersect(unique_downregulated_MHCC_15an, unique_downregulated_MHCC_15c)
intersect_downregulated_15a_15c <- intersect(unique_downregulated_MHCC_15a, unique_downregulated_MHCC_15c)
combined_upregulated_intersection <- union(intersect_upregulated_15an_15a, intersect_upregulated_15an_15c)
combined_upregulated_intersection <- union(combined_upregulated_intersection, intersect_upregulated_15a_15c)
combined_downregulated_intersection <- union(intersect_downregulated_15an_15a, intersect_downregulated_15an_15c)
combined_downregulated_intersection <- union(combined_downregulated_intersection, intersect_downregulated_15a_15c)
write.csv(combined_upregulated_intersection, "combined_upregulated_intersection.csv", row.names = FALSE)
write.csv(combined_downregulated_intersection, "combined_downregulated_intersection.csv", row.names = FALSE)
